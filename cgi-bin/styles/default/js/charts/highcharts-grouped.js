/**
 * Added by Anykey on 12.10.2015.
 *
 * https://github.com/blacklabel/grouped_categories/
 *
 * Author: Black Label.
 * License : CREATIVE COMMONS PUBLIC License
 */
!function(a,b){function r(a,b){return this.userOptions=A(a),this.name=a.name||a,this.parent=b,this}function t(a){for(var b=a.length,c=0;b--;)c+=a[b];return c}function u(a,b,c,d,e){var h,g=a.length;for(e||(e=0),c.depth||(c.depth=0);g--;)h=a[g],d&&(h.parent=d),h.categories?u(h.categories,b,c,h,e+1):v(b,h,d);c.depth=f(c.depth,e)}function v(a,b,c){for(a.unshift(new r(b,c));c;)c.leaves++||(c.leaves=1),c=c.parent}function w(a,b,c){b[0]===b[2]&&(b[0]=b[2]=d(b[0])-c%2/2),b[1]===b[3]&&(b[1]=b[3]=d(b[1])+c%2/2),a.push("M",b[0],b[1],"L",b[2],b[3])}function y(a,b){return a.getPosition(a.axis.horiz,b,a.axis.tickmarkOffset)}function z(a,b,c){for(var e,d=a.length;d--;)e=a[d][b],e&&z(e,b,c),c(a[d])}function A(a){return JSON.parse(JSON.stringify(a))}var c=void 0,d=Math.round,e=Math.min,f=Math.max,g=a.merge,h=a.pick,i=a.Axis.prototype,j=a.Tick.prototype,k=i.init,l=i.render,m=i.setCategories,n=j.getLabelSize,o=j.addLabel,p=j.destroy,q=j.render;r.prototype.toString=function(){for(var a=[],b=this;b;)a.push(b.name),b=b.parent;return a.join(", ")},i.init=function(a,b){k.call(this,a,b),"object"==typeof b&&b.categories&&this.setupGroups(b)},i.setupGroups=function(a){var b,c=[],d={};b=A(a.categories),u(b,c,d),this.categoriesTree=b,this.categories=c,this.isGrouped=0!==d.depth,this.labelsDepth=d.depth,this.labelsSizes=[],this.labelsGridPath=[],this.tickLength=a.tickLength||this.tickLength||null,this.tickWidth=h(a.tickWidth,this.isXAxis?1:0),this.directionFactor=[-1,1,1,-1][this.side],this.options.lineWidth=h(a.lineWidth,1)},i.render=function(){if(this.isGrouped&&(this.labelsGridPath=[]),this.originalTickLength===c&&(this.originalTickLength=this.options.tickLength),this.options.tickLength=this.isGrouped?.001:this.originalTickLength,l.call(this),!this.isGrouped)return void(this.labelsGrid&&this.labelsGrid.attr({visibility:"hidden"}));var q,a=this,b=a.options,d=a.top,e=a.left,f=e+a.width,g=d+a.height,h=a.hasVisibleSeries||a.hasData,i=a.labelsDepth,j=a.labelsGrid,k=a.horiz,m=a.labelsGridPath,n=b.drawHorizontalBorders===!1?i+1:0,o=a.opposite?k?d:f:k?g:e,p=a.tickWidth;for(a.userTickLength&&(i-=1),j||(j=a.labelsGrid=a.chart.renderer.path().attr({strokeWidth:p,"stroke-width":p,stroke:b.tickColor}).add(a.axisGroup));i>=n;)o+=a.groupSize(n),q=k?[e,o,f,o]:[o,d,o,g],w(m,q,p),n++;j.attr({d:m,visibility:h?"visible":"hidden"}),a.labelGroup.attr({visibility:h?"visible":"hidden"}),z(a.categoriesTree,"categories",function(b){var c=b.tick;c&&(c.startAt+c.leaves-1<a.min||c.startAt>a.max?(c.label.hide(),c.destroyed=0):c.label.attr({visibility:h?"visible":"hidden"}))})},i.setCategories=function(a,b){this.categories&&this.cleanGroups(),this.setupGroups({categories:a}),this.categories=this.userOptions.categories=a,m.call(this,this.categories,b)},i.cleanGroups=function(){var b,a=this.ticks;for(b in a)a[b].parent&&delete a[b].parent;z(this.categoriesTree,"categories",function(a){var c,b=a.tick;if(b){b.label.destroy();for(c in b)delete b[c];delete a.tick}}),this.labelsGrid=null},i.groupSize=function(a,b){var d=this.labelsSizes,e=this.directionFactor,g=this.options.labels.groupedOptions?this.options.labels.groupedOptions[a-1]:!1,h=0;return g&&(h=-1==e?g.x?g.x:0:g.y?g.y:0),b!==c&&(d[a]=f(d[a]||0,b+10+Math.abs(h))),a===!0?t(d)*e:d[a]?d[a]*e:0},j.addLabel=function(){var a;o.call(this),this.axis.categories&&(a=this.axis.categories[this.pos])&&(a.name&&this.label&&this.label.attr("text",this.axis.labelFormatter.call({axis:this.axis,chart:this.axis.chart,isFirst:this.isFirst,isLast:this.isLast,value:a.name})),this.axis.isGrouped&&this.axis.options.labels.enabled&&this.addGroupedLabels(a))},j.addGroupedLabels=function(a){for(var m,b=this,c=this.axis,d=c.chart,e=c.options.labels,f=e.useHTML,h=e.style,i=e.groupedOptions,j={align:"center",rotation:e.rotation,x:0,y:0},k=c.horiz?"height":"width",l=0;b;){if(l>0&&!a.tick){this.value=a.name;var n=e.formatter?e.formatter.call(this,a):a.name,o=i&&i[l-1],p=o?g(j,i[l-1]):j,q=o&&i[l-1].style?g(h,i[l-1].style):h;m=d.renderer.text(n,0,0,f).attr(p).css(q).add(c.labelGroup),b.startAt=this.pos,b.childCount=a.categories.length,b.leaves=a.leaves,b.visible=this.childCount,b.label=m,b.labelOffsets={x:p.x,y:p.y},a.tick=b}c.groupSize(l,b.label.getBBox()[k]),a=a.parent,b=a?b.parent=a.tick||{}:null,l++}},j.render=function(a,c,d){function I(a,c,d){var e=0;return l?(e=b.inArray(c.name,c.parent.categories),e=0>e?0:e):e}q.call(this,a,c,d);var g=this.axis.categories[this.pos];if(this.axis.isGrouped&&g&&!(this.pos>this.axis.max)){var C,D,E,F,G,H,h=this,i=h,j=h.axis,k=h.pos,l=h.isFirst,m=j.max,n=j.min,o=j.horiz,r=(j.categories[k],j.labelsGridPath),s=j.groupSize(0),u=(j.tickLength||s,j.tickWidth),x=(j.directionFactor,y(h,k)),z=o?x.y:x.x,A=j.chart.renderer.fontMetrics(j.options.labels.style.fontSize).b,B=1;for(l&&(C=o?[j.left,x.y,j.left,x.y+j.groupSize(!0)]:j.isXAxis?[x.x,j.top,x.x+j.groupSize(!0),j.top]:[x.x,j.top+j.len,x.x+j.groupSize(!0),j.top+j.len],w(r,C,u)),o&&j.left<x.x?w(r,[x.x,x.y,x.x,x.y+s],u):!o&&j.top<x.y&&w(r,[x.x,x.y,x.x+s,x.y],u),s=z+s;i=i.parent;){var J=I(i,g,h),K=i.labelOffsets.x,L=i.labelOffsets.y;E=y(h,f(i.startAt-1,n-1)),F=y(h,e(i.startAt+i.leaves-1-J,m)),H=i.label.getBBox(!0),D=j.groupSize(B),G=o?{x:(E.x+F.x)/2+K,y:s+D/2+A-H.height/2-4+L/2}:{x:s+D/2+K,y:(E.y+F.y-H.height)/2+A+L},isNaN(G.x)||isNaN(G.y)||(i.label.attr(G),r&&(o&&j.left<F.x?w(r,[F.x,s,F.x,s+D],u):!o&&j.top<F.y&&w(r,[s,F.y,s+D,F.y],u))),s+=D,B++}}},j.destroy=function(){for(var a=this;a=a.parent;)a.destroyed++||(a.destroyed=1);p.call(this)},j.getLabelSize=function(){return this.axis.isGrouped===!0?t(this.axis.labelsSizes):n.call(this)}}(Highcharts,HighchartsAdapter);